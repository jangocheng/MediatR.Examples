<div class="row">
    <div class="col-md-12">
        <h2 class="page-header" translate="ACTIVITY.VIEW.VIEW_ACTIVITY"></h2>
        <div id="activity-view-well" class="well">
            <button type="button" class="btn btn-default pull-right" ng-click="avvm.goToEdit()"><i class="fa fa-pencil"></i> <span translate="COMMON.EDIT"></span></button>
            <div>
                <span id="createdDate">{{avvm.activity.createdDate | date : 'dd-MM-yyyy'}}</span>
            </div>
            <div>
                <span id="activityType">{{avvm.activity.activityTypeId | dynamicTranslate}}</span>,
                <span id="activityStatus">{{avvm.activity.activityStatusId | dynamicTranslate}}</span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <section id="activity-view-property">
                    <h3 class="page-header" translate="ACTIVITY.VIEW.PROPERTY"></h3>
                    <card id="card-property" card-template-url="'app/property/templates/propertyCard.html'" item="avvm.activity.property" show-item-details="avvm.showPropertyPreview">
                    </card>
                </section>
                <section id="activity-view-vendors">
                    <list id="list-vendors">
                        <list-header>
                            <h3 class="page-header" translate="ACTIVITY.VIEW.VENDORS"></h3>
                        </list-header>
                        <list-no-items ng-show="avvm.activity.contacts.length === 0">
                            <p class="help-block" translate="ACTIVITY.VIEW.NO_VENDORS"></p>
                        </list-no-items>
                        <list-item id="list-item-{{contact.id}}" ng-repeat="contact in avvm.activity.contacts">
                            {{contact.getName()}}
                        </list-item>
                    </list>
                </section>
                <section>
                    <negotiators-view property-division-id="{{avvm.activity.property.divisionId}}" lead-negotiator="avvm.activity.leadNegotiator"
                        secondary-negotiators="avvm.activity.secondaryNegotiator"></negotiators-view>
                </section>
                <section id='departments-section'>
                    <card-list>
                        <card-list-header>
                            <h3 class="page-header" translate="DEPARTMENTS.COMMON.HEADER"></h3>
                        </card-list-header>
                        <card-list-item ng-repeat="activityDepartment in avvm.activity.activityDepartments | orderBy: 'department.name' | enumSorter: 'ActivityDepartmentType':'departmentTypeId'">
                            <card card-template-url="'app/activity/templates/departmentCard.html'" display-new-control="true" item="activityDepartment">
                            </card>
                        </card-list-item>
                    </card-list>
                </section>
            </div>
            <div class="col-md-4">
                <section id="activity-view-prices">
                    <h3 class="page-header" translate="ACTIVITY.VIEW.PRICES.PRICES"></h3>
                    <div class="section-row row">
                        <div class="col-xs-6" translate="ACTIVITY.VIEW.PRICES.MARKET_APPRAISAL_PRICE"></div>
                        <div id="marketAppraisalPrice" class="col-xs-6" ng-if="avvm.activity.marketAppraisalPrice !== null">{{avvm.activity.marketAppraisalPrice | number : 2 }} GBP</div>
                    </div>
                    <div class="section-row row">
                        <div class="col-xs-6" translate="ACTIVITY.VIEW.PRICES.RECOMMENDED_PRICE"></div>
                        <div id="recommendedPrice" class="col-xs-6" ng-if="avvm.activity.recommendedPrice !== null">{{avvm.activity.recommendedPrice | number : 2 }} GBP</div>
                    </div>
                    <div class="section-row row">
                        <div class="col-xs-6" translate="ACTIVITY.VIEW.PRICES.VENDOR_ESIMATED_PRICE"></div>
                        <div id="vendorEstimatedPrice" class="col-xs-6" ng-if="avvm.activity.vendorEstimatedPrice !== null">{{avvm.activity.vendorEstimatedPrice | number : 2 }} GBP</div>
                    </div>
                </section>
                <section id="activity-view-viewings">
                    <h3 class="page-header" translate="ACTIVITY.VIEW.VIEWINGS"></h3>
                    <card-list id="viewings-list">
                        <card-list-no-items ng-show="avvm.activity.viewings.length === 0">
                            <p class="help-block" translate="ACTIVITY.VIEW.NO_VIEWINGS"></p>
                        </card-list-no-items>
                        <card-list-item ng-repeat="group in avvm.activity.viewingsByDay | orderBy: '-day'">
                            <card-list-group class="viewing-group">
                                <card-list-group-header>
                                    <h5>
                                        <time>{{::group.viewings[0].startDate | date : 'dd-MM-yyyy'}}</time>
                                    </h5>
                                </card-list-group-header>
                                <card-list-group-item ng-repeat="viewing in group.viewings | orderBy: '-startDate' track by viewing.id">
                                    <card class="viewing-item" card-template-url="'app/activity/view/activityViewingsCard.html'" item="viewing" show-item-details="avvm.showViewingPreview">
                                    </card>
                                </card-list-group-item>
                            </card-list-group>
                        </card-list-item>
                    </card-list>
                </section>
                <section id="activity-view-attachments">
                    <card-list id="card-list-attachments" show-item-add="avvm.showActivityAttachmentAdd" is-item-add-disabled="avvm.saveActivityAttachmentBusy">
                        <card-list-header>
                            <h3 class="page-header" translate="ACTIVITY.VIEW.ATTACHMENTS"></h3>
                        </card-list-header>
                        <card-list-no-items ng-show="avvm.activity.attachments.length === 0">
                            <p class="help-block" translate="ACTIVITY.VIEW.NO_ATTACHMENTS"></p>
                        </card-list-no-items>
                        <card-list-item ng-repeat="attachment in avvm.activity.attachments | orderBy: avvm.attachmentsCartListOrder.name : avvm.attachmentsCartListOrder.descending track by attachment.id ">
                            <card id="attachment-card-{{::attachment.id}}" card-template-url="'app/activity/templates/activityAttachmentCard.html'" item="attachment"
                                show-item-details="avvm.showActivityAttachmentPreview">
                            </card>
                        </card-list-item>
                    </card-list>
                </section>
            </div>
            <div class="col-md-4">
                <section>
                    <h3 class="page-header" translate="ACTIVITY.VIEW.OFFERS"></h3>
                    <card-list-item class="activity-view-offers" ng-repeat="offer in avvm.activity.offers | orderBy: '-createdDate' | enumSorter: 'OfferStatus':'statusId' track by offer.id + offer.statusId + offer.offerDate">
                        <card card-template-url="'app/activity/view/activityOffersCard.html'" item="offer" show-item-details="avvm.showOfferPreview"
                            display-new-control="true" show-context-menu="true">
                            <card-context-menu>
                                <context-menu-item type="details" item="offer" action="avvm.navigateToOfferView"></context-menu-item>
                            </card-context-menu>
                        </card>
                    </card-list-item>
                </section>
            </div>
        </div>
    </div>
</div>

<side-panel component-id="avvm.componentIds.propertyPreviewSidePanelId">
    <side-panel-header>
        <h3 translate="PROPERTY.PREVIEW.PROPERTY_PREVIEW"></h3>
    </side-panel-header>
    <side-panel-content>
        <property-preview component-id="avvm.componentIds.propertyPreviewId">
        </property-preview>
    </side-panel-content>
</side-panel>

<side-panel component-id="avvm.componentIds.activityAttachmentAddSidePanelId" is-busy="avvm.saveActivityAttachmentBusy">
    <side-panel-header>
        <h3 translate="ATTACHMENT.ADD.ATTACH_FILE"></h3>
    </side-panel-header>
    <side-panel-content>
        <attachment-upload component-id="avvm.componentIds.activityAttachmentAddId" enum-document-type="{{avvm.enumTypeActivityDocumentType}}" entity-type="{{avvm.entityType}}"></attachment-upload>
        <busy is-busy="avvm.saveActivityAttachmentBusy" label="{{'COMMON.FILEISUPLOADING' | translate}}"></busy>
    </side-panel-content>
    <side-panel-footer>
        <button class="btn btn-default" type="button" ng-click="avvm.cancelActivityAttachmentAdd()">
            <i class="fa fa-ban"></i> <span translate="COMMON.CANCEL"></span>
        </button>
        <button class="btn btn-primary" type="button" id="attachment-add-button" ng-click="avvm.saveActivityAttachment()">
            <i class="fa fa-floppy-o"></i> <span translate="COMMON.SAVE"></span>
        </button>
    </side-panel-footer>
</side-panel>

<side-panel component-id="avvm.componentIds.activityAttachmentPreviewSidePanelId">
    <side-panel-header>
        <h3 translate="ATTACHMENT.PREVIEW.ATTACHMENT_PREVIEW"></h3>
    </side-panel-header>
    <side-panel-content>
        <attachment-preview component-id="avvm.componentIds.activityAttachmentPreviewId" entity-type="{{avvm.entityType}}">
        </attachment-preview>
    </side-panel-content>
</side-panel>

<side-panel component-id="avvm.componentIds.previewViewingSidePanelId" id="viewing-panel">
    <side-panel-header>
        <h3 translate="ACTIVITY.VIEW.VIEWING_DETAILS"></h3>
    </side-panel-header>
    <side-panel-content>
        <viewing-preview component-id="avvm.componentIds.viewingPreviewId" viewing="avvm.selectedViewing">
            <viewing-preview-custom-item>
                <requirement-card requirement="avvm.selectedViewing.requirement" />
            </viewing-preview-custom-item>
        </viewing-preview>
    </side-panel-content>
</side-panel>

<side-panel component-id="avvm.componentIds.offerPreviewSidePanelId">
    <side-panel-header>
        <h3 translate="ACTIVITY.VIEW.OFFERPREVIEW"></h3>
    </side-panel-header>
    <side-panel-content>
        <offer-preview component-id="avvm.componentIds.offerPreviewId" offer="avvm.selectedOffer">
            <offer-preview-custom-item>
                <requirement-card requirement="avvm.selectedOffer.requirement" />
            </offer-preview-custom-item>
        </offer-preview>
    </side-panel-content>
</side-panel>